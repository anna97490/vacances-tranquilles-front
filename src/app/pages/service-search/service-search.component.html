<div class="service-search-container">
  <div class="container">
    <h2 class="main-title">Recherchez votre service</h2>
    <p class="subtitle">Sélectionnez vos critères</p>
    <div class="form-card">
      <form #searchForm="ngForm" autocomplete="off">
        <div class="form-section">
          <label class="section-label" for="day-select">Sélectionner une date</label>
          <div class="date-row">
            <mat-form-field appearance="outline">
              <mat-select id="day-select" placeholder="Jour" [(ngModel)]="selectedDay" name="day" required #dayCtrl="ngModel" (selectionChange)="onDayChange()">
                <mat-option *ngFor="let day of days" [value]="day">{{ day }}</mat-option>
              </mat-select>
              <mat-error *ngIf="dayCtrl.invalid && dayCtrl.touched">Jour requis</mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-select id="month-select" placeholder="Mois" [(ngModel)]="selectedMonth" name="month" required #monthCtrl="ngModel" (selectionChange)="onMonthChange()">
                <mat-option *ngFor="let month of months" [value]="month">{{ month }}</mat-option>
              </mat-select>
              <mat-error *ngIf="monthCtrl.invalid && monthCtrl.touched">Mois requis</mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-select id="year-select" placeholder="Année" [(ngModel)]="selectedYear" name="year" required #yearCtrl="ngModel" (selectionChange)="onYearChange()">
                <mat-option *ngFor="let year of years" [value]="year">{{ year }}</mat-option>
              </mat-select>
              <mat-error *ngIf="yearCtrl.invalid && yearCtrl.touched">Année requise</mat-error>
            </mat-form-field>
          </div>
          <div class="date-error" *ngIf="selectedDay && selectedMonth && selectedYear && isDateInPast">
            <mat-error>La date sélectionnée ne peut pas être dans le passé</mat-error>
          </div>
        </div>
        <div class="form-section">
          <label class="section-label" for="start-hour-select">Sélectionner un horaire</label>
          <div class="hour-row">
            <mat-form-field appearance="outline">
              <mat-select id="start-hour-select" placeholder="Heure de début" [(ngModel)]="selectedStartHour" name="startHour" [disabled]="!selectedDay || !selectedMonth || !selectedYear" #startHourCtrl="ngModel" (selectionChange)="onStartHourChange()">
                <mat-option *ngFor="let hour of hours" [value]="hour">{{ hour }}</mat-option>
              </mat-select>
              <mat-error *ngIf="startHourCtrl.invalid && startHourCtrl.touched">Heure de début requise</mat-error>
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-select id="end-hour-select" placeholder="Heure de fin" [(ngModel)]="selectedEndHour" name="endHour" [disabled]="!selectedStartHour" #endHourCtrl="ngModel">
                <mat-option *ngFor="let hour of availableEndHours" [value]="hour">{{ hour }}</mat-option>
              </mat-select>
              <mat-error *ngIf="endHourCtrl.invalid && endHourCtrl.touched">Heure de fin requise</mat-error>
              <mat-error *ngIf="selectedStartHour && !availableEndHours.length">Aucune heure de fin disponible après l'heure de début sélectionnée</mat-error>
            </mat-form-field>
          </div>
        </div>
        <div class="form-section">
          <mat-form-field appearance="outline" class="full-width">
            <input matInput id="postal-code-input" placeholder="Entrez votre code postal" [(ngModel)]="postalCode" name="postalCode" maxlength="5" pattern="^[0-9]{5}$" required #postalCtrl="ngModel">
            <mat-error *ngIf="postalCtrl.invalid && postalCtrl.touched">Code postal requis (5 chiffres)</mat-error>
            <mat-error *ngIf="postalCode && !isPostalCodeValid">Code postal invalide</mat-error>
          </mat-form-field>
        </div>
        <div class="form-section">
          <mat-form-field appearance="outline" class="full-width">
            <mat-select id="service-select" placeholder="Choisissez un service" [(ngModel)]="selectedService" name="service" required #serviceCtrl="ngModel">
              <mat-option *ngFor="let service of services" [value]="service.key">{{ service.value }}</mat-option>
            </mat-select>
            <mat-error *ngIf="serviceCtrl.invalid && serviceCtrl.touched">Service requis</mat-error>
          </mat-form-field>
        </div>
        <div class="button-zone">
          <button mat-raised-button color="primary" class="main-action-btn" [disabled]="!isFormValid() || isLoading" (click)="findProviders()">
            <span *ngIf="!isLoading">Voir les prestataires disponibles</span>
            <span *ngIf="isLoading">Recherche en cours...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<app-footer></app-footer>